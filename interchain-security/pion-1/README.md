# Please use go version [>=1.21](https://go.dev/doc/install) to compile binaries!!

# `pion-1` Chain Details

The `pion-1` chain will be launched as a Neutron persistent chain to test Interchain Security functionality.

* **Chain-ID**: `pion-1`
* **denom**: `untrn`
* **minimum-gas-prices**: `0untrn`
* **timeout_commit**: `1s`
* **Spawn time**: `2023-06-29T14:30:00Z`
* **GitHub repo**: [neutron-org/neutron](https://github.com/neutron-org/neutron.git)
* **Current version**: [`v5.1.1`](https://github.com/neutron-org/neutron/releases/tag/v5.1.1)
  * Launch version: [`v1.0.2-pion-1-upgrade`](https://github.com/neutron-org/neutron/releases/tag/v1.0.2-pion-1-upgrade)
* **Genesis file with CCV state:** [pion-1-genesis.json](https://github.com/cosmos/testnets/blob/master/interchain-security/pion-1/pion-1-genesis-with-ccv.json.gz)

* **Reference binary**: [neutrond-linux-amd64](neutrond-linux-amd64)
* **Binary sha256sum**: `62200756847af9daf3d9578afc0902a705911255dc16a846f5a5770d0c44b41b`
* **Genesis file _without CCV state_:** [pion-1-genesis-without-ccv.json](https://github.com/cosmos/testnets/raw/master/interchain-security/pion-1/pion-1-genesis-without-ccv.json.gz ), verify with `gzip -d pion-1-genesis-without-ccv.json.gz -c | shasum -a 256`
* * **Genesis file _with CCV state_:** [pion-1-genesis-with-ccv.json](https://github.com/cosmos/testnets/raw/master/interchain-security/pion-1/pion-1-genesis-with-ccv.json.gz ), verify with `gzip -d pion-1-genesis-with-ccv.json.gz -c | jq -S -c -M '.' | shasum -a 256`
* **SHA256 for genesis file _without CCV state_**: `6291227072026b46830a7bcdd6180dca727f10d92fd612cedc07b6d377b0eeea`
* * **SHA256 for genesis file _with CCV state_**: `2cbb264125915270e5f2fccf3c8ef9578f432c4a5ba7c9b0c536ba80922678be`


* Genesis file hash
  * The SHA256 is used to verify against the genesis file (without CCV state) that the proposer has made available for review.
  * The `pion-1-genesis-without-ccv.json` file cannot be used to run the chain: it must be updated with the CCV (Cross Chain Validation) state after the spawn time is reached.
  * The genesis file includes funds for a relayer and a faucet account as well as account with funds for different internal needs, `signed_blocks_window` has been set to `2304000`, and `min_signed_per_window` has been set to `5%`.
* Binary hash
  * The `neutrond-linux-amd64` binary is only provided to verify the SHA256. It was built with Interchain Security release [`v1.0.2-pion-1-upgrade`](https://github.com/neutron-org/neutron/releases/tag/v1.0.2-pion-1-upgrade). You can generate the binary following the build instructions in that repo or using one of the scripts provided here.
* Spawn time
  * Even if a proposal passes, the CCV state will not be available from the provider chain until after the spawn time is reached.

> If you want to build genesis by your own please take into account difference between the `ccvconsumer` section generated by version v10.0.1 of `gaiad` and the `ccvconsumer` section required for Neutron to run. Please check and add `"soft_opt_out_threshold": "0.05"` to the `params` section if it absent.

For more information regarding the consumer chain creation process, see [CCV: Overview and Basic Concepts](https://github.com/cosmos/ibc/blob/main/spec/app/ics-028-cross-chain-validation/overview_and_basic_concepts.md).

## Configuration

Update app.toml and set `iavl-disable-fastnode = false`. Also you need to disable Rosetta service in the same configuration file.

## Endpoints

Endpoints are exposed as subdomains for the sentry and snapshot nodes (described below) as follows:

* `https://rest-palvus.pion-1.ntrn.tech:443`
* `https://rpc-palvus.pion-1.ntrn.tech:443`
* `http://grpc-palvus.pion-1.ntrn.tech:80`

Seed nodes:

1. `4dbb91a22ec4222751aec7f682ea20c2c907f09d@p2p-palvus.pion-1.ntrn.tech:26656`

State sync nodes:

1. `pion.ics-testnet.polypore.xyz:26657`

Persistent nodes:

1. `5f0604c2b8161004866c954c1d877f565b2fc69c@pion-banana.ics-testnet.polypore.xyz:26656`
2. `6e7c0583e6e18fccedcceaffc1ac5a33ab898fa8@pion-cherry.ics-testnet.polypore.xyz:26656`

## Block Explorers

* https://explorer.polypore.xyz/pion-1/
* https://testnet.mintscan.io/neutron-testnet

## Snapshot
* https://snapshots.polypore.xyz/ics-testnet/pion-1/

## IBC Data

### Clients

* `07-tendermint-68`
  * Counterparty: [`provider`](/interchain-security/provider/README.md) `07-tendermint-28`

### Connections

* `connection-42`
  * Counterparty: [`provider`](/interchain-security/provider/README.md) `connection-19`

### Channels

* `channel-95`: consumer port
  * Counterparty: [`provider`](/interchain-security/provider/README.md) `channel-31`
* `channel-96`: transfer port
  * Counterparty: [`provider`](/interchain-security/provider/README.md) `channel-32`

## How to Join

### Hardware Requirements

* 4 Cores
* 64 GB RAM
* 2x512 GB SSD

### Software Versions

| Name    | Version |
| ------- | ------- |
| Neutron | v5.1.1  |
| Go      | >=1.21  |

The scripts provided in this repo will install Neutron and set up a Cosmovisor service with the auto-download feature enabled on your machine.

#### Bash Script

##### Before the relaunch make sure you removed the previous state of the chain!
```bash
neutrond tendermint unsafe-reset-all --home <YOUR_PREVIOUS_NEUTROND_HOME_DIR>
```

The script provided in this repo will install `neutrond` and set up a Cosmovisor service on your machine. 

Run script provided to set up a `pion-1` service:
* `join-rs-pion-1.sh` will create a `pion-1` service with `cosmovisor` support.
* Script must be run either as root or from a sudoer account.
* Script will attempt to build a binary from the [neutron-org/neutron] repo.
* To sync with Hypha's `pion-1` snapshot run with the `-s` argument

If you are setting up a validator you will need to set up the `slinky` service:
* `install-slinky.sh` will install the `slinky` and set up the `slinky` service
* Script must be run either as root or from a sudoer account.

If you need to stop Slinky temporarily, adjust your Neutron `app.toml` file as follows to avoid missing blocks while Slinky is offline:
  * In the `[oracle]` section, set `client_timeout = "500ms"`
  * This will keep the oracle from timing out.
  * Once you start Slinky back up, you can set `client_timeout = "2s"` again.

### Node manual installation

Build and install neutron binary. 

```
$ git clone -b v5.1.1 https://github.com/neutron-org/neutron.git
$ cd neutron
$ make install
```

after installation please check installed version by running:

`neutrond version --long`

You should see the following:
```
name: neutron
server_name: neutrond
version: v5.1.1
```

If you are joining as a validator you must install and run `slinky` v1.0.13 as a service. To install follow this steps:

```
$ git clone -b v1.0.13 https://github.com/skip-mev/connect.git
$ cd connect
$ make install
```
### Troubleshooting

If you see error like this during startup:

`Error: maximum number of retries exceeded, last error: rpc error: code = Unknown desc = failed to load state at height 0; version mismatch on immutable IAVL tree; version does not exist. Version has either been pruned, or is for a future block height (latest height: 0): invalid request`

Disable the Rosetta service in `app.toml`, reset state (`neutrond tendermint unsafe-reset-all --home ~/.neutrond --keep-addr-book`), and start the node again.
